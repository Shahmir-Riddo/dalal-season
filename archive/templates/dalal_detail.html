{% extends 'base.html' %}
{% load static %}
{% block title %}
{{ dalal.name }}
{% endblock title %}
{% block body %}

<style>
    .wanted-badge {
        background: red;
        color: white;
        font-weight: bold;
        font-size: 1.2rem;
        padding: 0.3rem 0.7rem;
        border-radius: 0.25rem;
        text-transform: uppercase;
        display: inline-block;
        animation: blink 1s infinite;
    }

    @keyframes blink {
        0%, 50%, 100% { opacity: 1; }
        25%, 75% { opacity: 0; }
    }

    .traitor-progress {
        height: 12px;
        border-radius: 8px;
        overflow: hidden;
    }

    .traitor-bar {
        background: repeating-linear-gradient(
            45deg,
            #ff0000,
            #ff0000 10px,
            #990000 10px,
            #990000 20px
        );
    }

    .humiliate-text {
        color: #990000;
        font-weight: bold;
        font-size: 1.1rem;
        margin-top: 10px;
    }

    .profile-card {
        border: 2px dashed red;
        background: rgba(23, 4, 4, 1);
        position: relative;
    }

    .profile-card::before {
     
        position: absolute;
        top: -20px;
        left: 50%;
        transform: translateX(-50%);
        font-weight: bold;
        color: darkred;
      
    }

.fixed-img {
  width: 12.5rem;     /* ~200px */
  height: 12.5rem;     /* fixed height */
  object-fit: cover; /* crop to fit box without stretching */
  border-radius: 8px; /* optional: make corners neat */
}

</style>
{% include "navbar.html" %}
<div class="container my-6">
    <div class="row g-4">

        <!-- Profile Image & Wanted -->
        <div class="col-md-4 text-center">
            <div class="position-relative d-inline-block">
                {% if dalal.picture %}
                    <img src="{{ dalal.picture.url }}" alt="{{ dalal.name }}" class="fixed-img rounded shadow-sm border border-danger">
                {% else %}
                    <img src="{% static 'videos/loader.gif' %}" alt="No Image" class="img-fluid rounded shadow-sm border border-danger">
                {% endif %}
                <div class="wanted-badge position-absolute top-0 start-50 translate-middle-x mt-2">WANTED</div>
            </div>
            
            <h3 class="mt-3 text-danger">{{ dalal.name|upper }}</h3>
            <p class="mb-1"><strong>Role:</strong> {{ dalal.role }}</p>
            {% if dalal.affiliation %}
            <p class="mb-1"><strong>Affiliation:</strong> {{ dalal.affiliation }}</p>
            {% endif %}
            <p class="mb-1"><strong>Status:</strong> 
                <span class="badge 
                    {% if dalal.status == 'available' %}bg-orange
                    {% elif dalal.status == 'captured' %}bg-primary
                    {% elif dalal.status == 'fugitive' %}bg-danger
                    {% elif dalal.status == 'terminated' %}bg-success
                    {% else %}bg-danger
                    {% endif %}">
                    {{ dalal.get_status_display }}
                </span>
            </p>
            {% if dalal.district %}
                <p class="mb-1"><strong>District:</strong> {{ dalal.district.name }}</p>
            {% endif %}
            {% if dalal.country %}
                <p class="mb-1"><strong>Country:</strong> {{ dalal.country }}</p>
            {% endif %}
        </div>

        <!-- Profile Info & Humiliation -->
        <!-- Profile Info & Humiliation -->
<div class="col-md-8">
    <div class="card shadow-sm border-0 profile-card">
        <div class="card-body">

            <!-- Buttons moved to top -->
            <div class="d-flex gap-2 mb-3">
                <a class="btn btn-danger btn-sm" href="/">
                    <i class="fas fa-arrow-left"></i>
                </a>
                <form id="shoeForm" method="POST" class="m-0">
                    {% csrf_token %}
                    <input type="hidden" name="dalal_id" value="{{ dalal.id }}">
                    <button id="shoeBtn" class="btn btn-outline-danger btn-sm" type="submit">
                        <i class="fas fa-shoe-prints"></i> <span id="shoeCount">{{ dalal.shoe_count }}</span>
                    </button>
                </form>

                
            </div>

            <h5 class="card-title mb-3 text-danger">Profile Report</h5>
            {% if dalal.profile_report %}
                <div>{{ dalal.profile_report|safe }}</div>
            {% else %}
                <p class="humiliate-text">Information about {{ dalal.name }} is incomplete.</p>
            {% endif %}

            <hr class="border-danger">

            <p class="mb-1"><strong>Traitor Rank:</strong> {{ dalal.traitor_rank }} / 100</p>
            <div class="progress traitor-progress mb-3">
                <div class="progress-bar traitor-bar" role="progressbar" style="width: {{ dalal.traitor_rank }}%" 
                     aria-valuenow="{{ dalal.traitor_rank }}" aria-valuemin="0" aria-valuemax="100"></div>
            </div>

            <p class="mb-1"><strong>Shoe Count:</strong> {{ dalal.shoe_count }}</p>
            {% if dalal.address_last_known %}
                <p class="mb-0"><strong>Last Known Address:</strong> {{ dalal.address_last_known }}</p>
            {% endif %}

            <p class="humiliate-text mt-3">This dalal is a disgrace. Handle with caution!</p>
        </div>
    </div>
</div>

            </div>
        </div>

    </div>
</div>
<script>
document.getElementById("shoeForm").addEventListener("submit", async function(e) {
    e.preventDefault(); // stop reload

    let form = e.target;
    let formData = new FormData(form);

    let response = await fetch("{% url 'dalal_shoe_count' %}", {
        method: "POST",
        body: formData,
        headers: {
            "X-Requested-With": "XMLHttpRequest"
        }
    });

    if (response.ok) {
        let data = await response.json();
        document.getElementById("shoeCount").innerText = data.shoe_count; // update count
    }
});
</script>
{% endblock %}
